{"version":3,"file":"index.js","sources":["../src/grpcProtoLoader.js","../src/Protocols.lsc","../src/util.lsc","../src/StreamHandler.lsc","../src/ClientEnhancer.lsc","../src/ServerEnhancer.lsc"],"sourcesContent":["/**\n * @license\n * Copyright 2018 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n// @enmeshed: Modification of gRPC's protobuf loader. The primary change\n// is to give programmatic access to the Protobuf root.\n\nvar fs = require(\"fs\");\nvar path = require(\"path\");\nvar Protobuf = require(\"protobufjs\");\nvar descriptor = require(\"protobufjs/ext/descriptor\");\nvar camelCase = require(\"lodash.camelcase\");\nvar descriptorOptions = {\n    longs: String,\n    enums: String,\n    bytes: String,\n    defaults: true,\n    oneofs: true,\n    json: true\n};\nfunction joinName(baseName, name) {\n    if (baseName === '') {\n        return name;\n    }\n    else {\n        return baseName + '.' + name;\n    }\n}\nfunction isHandledReflectionObject(obj) {\n    return obj instanceof Protobuf.Service || obj instanceof Protobuf.Type ||\n        obj instanceof Protobuf.Enum;\n}\nfunction isNamespaceBase(obj) {\n    return obj instanceof Protobuf.Namespace || obj instanceof Protobuf.Root;\n}\nfunction getAllHandledReflectionObjects(obj, parentName) {\n    var objName = joinName(parentName, obj.name);\n    if (isHandledReflectionObject(obj)) {\n        return [[objName, obj]];\n    }\n    else {\n        if (isNamespaceBase(obj) && typeof obj.nested !== undefined) {\n            return Object.keys(obj.nested)\n                .map(function (name) {\n                return getAllHandledReflectionObjects(obj.nested[name], objName);\n            })\n                .reduce(function (accumulator, currentValue) { return accumulator.concat(currentValue); }, []);\n        }\n    }\n    return [];\n}\nfunction createDeserializer(cls, options) {\n    return function deserialize(argBuf) {\n        return cls.toObject(cls.decode(argBuf), options);\n    };\n}\nfunction createSerializer(cls) {\n    return function serialize(arg) {\n        var message = cls.fromObject(arg);\n        return cls.encode(message).finish();\n    };\n}\nfunction createMethodDefinition(method, serviceName, options) {\n    /* This is only ever called after the corresponding root.resolveAll(), so we\n     * can assume that the resolved request and response types are non-null */\n    var requestType = method.resolvedRequestType;\n    var responseType = method.resolvedResponseType;\n    return {\n        path: '/' + serviceName + '/' + method.name,\n        requestStream: !!method.requestStream,\n        responseStream: !!method.responseStream,\n        requestSerialize: createSerializer(requestType),\n        requestDeserialize: createDeserializer(requestType, options),\n        responseSerialize: createSerializer(responseType),\n        responseDeserialize: createDeserializer(responseType, options),\n        // TODO(murgatroid99): Find a better way to handle this\n        originalName: camelCase(method.name),\n        requestType: createMessageDefinition(requestType),\n        responseType: createMessageDefinition(responseType)\n    };\n}\nfunction createServiceDefinition(service, name, options) {\n    var def = {};\n    for (var _i = 0, _a = service.methodsArray; _i < _a.length; _i++) {\n        var method = _a[_i];\n        def[method.name] = createMethodDefinition(method, name, options);\n    }\n    return def;\n}\nvar fileDescriptorCache = new Map();\nfunction getFileDescriptors(root) {\n    if (fileDescriptorCache.has(root)) {\n        return fileDescriptorCache.get(root);\n    }\n    else {\n        var descriptorList = root.toDescriptor('proto3').file;\n        var bufferList = descriptorList.map(function (value) {\n            return Buffer.from(descriptor.FileDescriptorProto.encode(value).finish());\n        });\n        fileDescriptorCache.set(root, bufferList);\n        return bufferList;\n    }\n}\nfunction createMessageDefinition(message) {\n    var messageDescriptor = message.toDescriptor('proto3');\n    return {\n        format: 'Protocol Buffer 3 DescriptorProto',\n        type: messageDescriptor.$type.toObject(messageDescriptor, descriptorOptions),\n        fileDescriptorProtos: getFileDescriptors(message.root)\n    };\n}\nfunction createEnumDefinition(enumType) {\n    var enumDescriptor = enumType.toDescriptor('proto3');\n    return {\n        format: 'Protocol Buffer 3 EnumDescriptorProto',\n        type: enumDescriptor.$type.toObject(enumDescriptor, descriptorOptions),\n        fileDescriptorProtos: getFileDescriptors(enumType.root)\n    };\n}\n/**\n * function createDefinition(obj: Protobuf.Service, name: string, options:\n * Options): ServiceDefinition; function createDefinition(obj: Protobuf.Type,\n * name: string, options: Options): MessageTypeDefinition; function\n * createDefinition(obj: Protobuf.Enum, name: string, options: Options):\n * EnumTypeDefinition;\n */\nfunction createDefinition(obj, name, options) {\n    if (obj instanceof Protobuf.Service) {\n        return createServiceDefinition(obj, name, options);\n    }\n    else if (obj instanceof Protobuf.Type) {\n        return createMessageDefinition(obj);\n    }\n    else if (obj instanceof Protobuf.Enum) {\n        return createEnumDefinition(obj);\n    }\n    else {\n        throw new Error('Type mismatch in reflection object handling');\n    }\n}\nfunction createPackageDefinition(root, options) {\n    var def = {};\n    root.resolveAll();\n    for (var _i = 0, _a = getAllHandledReflectionObjects(root, ''); _i < _a.length; _i++) {\n        var _b = _a[_i], name = _b[0], obj = _b[1];\n        def[name] = createDefinition(obj, name, options);\n    }\n    return def;\n}\nfunction addIncludePathResolver(root, includePaths) {\n    var originalResolvePath = root.resolvePath;\n    root.resolvePath = function (origin, target) {\n        if (path.isAbsolute(target)) {\n            return target;\n        }\n        for (var _i = 0, includePaths_1 = includePaths; _i < includePaths_1.length; _i++) {\n            var directory = includePaths_1[_i];\n            var fullPath = path.join(directory, target);\n            try {\n                fs.accessSync(fullPath, fs.constants.R_OK);\n                return fullPath;\n            }\n            catch (err) {\n                continue;\n            }\n        }\n        return originalResolvePath(origin, target);\n    };\n}\n/**\n * Load a .proto file with the specified options.\n * @param filename One or multiple file paths to load. Can be an absolute path\n *     or relative to an include path.\n * @param options.keepCase Preserve field names. The default is to change them\n *     to camel case.\n * @param options.longs The type that should be used to represent `long` values.\n *     Valid options are `Number` and `String`. Defaults to a `Long` object type\n *     from a library.\n * @param options.enums The type that should be used to represent `enum` values.\n *     The only valid option is `String`. Defaults to the numeric value.\n * @param options.bytes The type that should be used to represent `bytes`\n *     values. Valid options are `Array` and `String`. The default is to use\n *     `Buffer`.\n * @param options.defaults Set default values on output objects. Defaults to\n *     `false`.\n * @param options.arrays Set empty arrays for missing array values even if\n *     `defaults` is `false`. Defaults to `false`.\n * @param options.objects Set empty objects for missing object values even if\n *     `defaults` is `false`. Defaults to `false`.\n * @param options.oneofs Set virtual oneof properties to the present field's\n *     name\n * @param options.includeDirs Paths to search for imported `.proto` files.\n */\nexport function load(filename, options) {\n    options = options || {};\n\n    if (!!options.includeDirs) {\n        if (!(Array.isArray(options.includeDirs))) {\n            return Promise.reject(new Error('The includeDirs option must be an array'));\n        }\n        addIncludePathResolver(root, options.includeDirs);\n    }\n    return root.load(filename, options).then(function (loadedRoot) {\n        loadedRoot.resolveAll();\n        return createPackageDefinition(root, options);\n    });\n}\n\nexport function loadSync(filename, options) {\n    options = options || {};\n    var root = options.root || (new Protobuf.Root());\n    if (!!options.includeDirs) {\n        if (!(Array.isArray(options.includeDirs))) {\n            throw new Error('The includeDirs option must be an array');\n        }\n        addIncludePathResolver(root, options.includeDirs);\n    }\n    var loadedRoot = root.loadSync(filename, options);\n    loadedRoot.resolveAll();\n    return createPackageDefinition(root, options);\n}\n\n// Load Google's well-known proto files that aren't exposed by Protobuf.js.\n{\n    // Protobuf.js exposes: any, duration, empty, field_mask, struct, timestamp,\n    // and wrappers. compiler/plugin is excluded in Protobuf.js and here.\n    var wellKnownProtos = ['api', 'descriptor', 'source_context', 'type'];\n    var sourceDir = path.join(path.dirname(require.resolve('protobufjs')), 'google', 'protobuf');\n    for (var _i = 0, wellKnownProtos_1 = wellKnownProtos; _i < wellKnownProtos_1.length; _i++) {\n        var proto = wellKnownProtos_1[_i];\n        var file = path.join(sourceDir, proto + \".proto\");\n        var descriptor_1 = Protobuf.loadSync(file).toJSON();\n        // @ts-ignore\n        Protobuf.common(proto, descriptor_1.nested.google.nested);\n    }\n}\n//# sourceMappingURL=index.js.map\n","// Create a client for a grpc service bouncing off an Envoy sidecar on port 3000\nimport path from 'path'\nimport fs from 'fs'\ngrpc = require('@grpc/grpc-js')\nimport { loadSync } from './grpcProtoLoader'\nProtobuf = require(\"protobufjs\")\n\nat(obj, path) ->\n  let ret = obj\n  for elem e in path:\n    now ret = ret[e]\n  ret\n\nexport class Protocols:\n  _loaded = false\n  _root = null\n  _includeDirs = []\n  _files = []\n  _pkgs = null\n  loadOptions = {\n    keepCase: true, longs: String, enums: String, defaults: true, oneofs: true\n  }\n\n  setProtoPath(...includeDirs) ->\n    this._includeDirs = includeDirs\n    this\n\n  addProtoPath(dir) ->\n    this._includeDirs.push(dir)\n    this\n\n  // Create a gRPC client for the given named service\n  client(protoName, port, credentials, opts) ->\n    pth = protoName.split('.')\n    client = at(this._pkgs, pth)\n    new client(port, credentials, opts)\n\n  // Retrieve a gRPC service def for the given named service\n  service(protoName) ->\n    pth = protoName.split('.')\n    client = at(this._pkgs, pth)\n    client.service\n\n  type(typeName) ->\n    this._root.lookupType(typeName)\n\n  require(protoFile): void ->\n    if this._loaded:\n      throw new Error(`Protocols.require: cannot call require() after protocols are already loaded.`)\n    fileName = `${protoFile}.proto`\n    // Resolve the proto package in the include dirs\n    for elem dir in this._includeDirs:\n      target = path.resolve(dir, fileName)\n      if fs.existsSync(target):\n        this._files.push(target)\n        return // first match wins\n    // File not found\n    throw new Error(`Protocols.require: could not find protocol file matching '${fileName}' in include path.`)\n\n  load(): void ->\n    if this._loaded: return\n    this._root = new Protobuf.Root()\n    opts = Object.assign({}, this.loadOptions, { includeDirs: this._includeDirs, root: this._root })\n    pkgDef = loadSync(this._files, opts)\n    this._pkgs = grpc.loadPackageDefinition(pkgDef)\n","deferred = require('p-defer')\n\n// Classify a method on a grpc client object\nexport classifyMethod(method): string ->\n  { requestStream, responseStream } = method\n\n  if (not requestStream) and (not responseStream):\n    'unary'\n  elif requestStream and (not responseStream):\n    'requestStream'\n  elif (not requestStream) and responseStream:\n    'responseStream'\n  elif requestStream and responseStream:\n    'bidirectionalStream'\n  else:\n    throw new Error('classifyMethod: unrecognized method')\n\nexport isThenable(thing): bool ->\n  ty = typeof(thing)\n  thing and (ty == 'object' or ty == 'function') and (typeof(thing.then) == 'function')\n\nexport { deferred }\n","import { isThenable, deferred } from './util'\n\nexport class StreamHandler:\n  constructor(stream) ->\n    this.stream = stream\n\n  // Create a stream handler on the fly with given callbacks.\n  static with(callbacks) ->\n    next = new this(null)\n    Object.assign(next, callbacks)\n    next\n\n  marshalError(err) -> err\n\n  // Hangs up this end of the stream, indicating no more data will be sent.\n  // If the `err` argument exists, the stream will instead end with an\n  // error condition.\n  end(err) ->\n    if err:\n      this._iFailed = true\n      this.stream.emit('error', this.marshalError(err))\n    else:\n      this.stream.end()\n      // if(\n      //   this.stream.writable\n      //   // XXX: It may be that the peer hung up BOTH ends of the stream,\n      //   // for example if the peer process was killed at the OS level.\n      //   // gRPC does not handle this well and still tries to write a final\n      //   // packet, crashing the whole app.\n      //   //\n      //   // Dig into the innards here and verify this isn't the case.\n      //   and this.stream.call?.stream?.writable\n      // ):\n      //   this.stream.end()\n      // else:\n      //   console.error(\"wtf stream not writeable\", this.stream.call.stream)\n\n  // Writes data to the stream. Data must be an object matching the appropriate\n  // protobuf.\n  write(data) ->\n    this.stream.write(data)\n\n  // Handle an error. Any error automatically closes the stream, so it is\n  // not necessary to close the stream in the handler.\n  // The isInternal argument is `true` if the error was generated by\n  // user code on this side of the stream.\n  error(err, isInternal: boolean): void -> return\n\n  // Called when the stream is opened, before any incoming data is processed.\n  // The stream is writeable at this point; metadata can be sent as well as\n  // initial greetings.\n  start(stream): void -> return\n\n  // Called when the other end of the stream hangs up, indicating no more\n  // data will be received on this end. It is still OK to write responses\n  // to the stream at this point.\n  hangup(): void -> return\n\n  // Called when receiving a packet. If this method returns a Promise,\n  // it is treated as asynchronously producing a response which will be\n  // written to the stream. Otherwise it is treated as a synchronous\n  // event handler\n  data(packet) -> return\n\n  // A promise that is settled when the stream is closed.\n  closedPromise() ->\n    // Already closed!\n    err = this.getError()\n    if err:\n      return Promise.reject(err)\n    elif this.isClosed():\n      return Promise.resolve(this)\n\n    // Defer\n    if not this._doneDeferred: this._doneDeferred = deferred()\n    this._doneDeferred.promise\n\n  // True when both ends of the stream have hung up, or an error occurred.\n  isClosed() ->\n    if this._error or (this._end and this._finish): true else: false\n\n  // True when any error occured.\n  getError() -> this._error\n\n  // Internal event processing.\n  _internal(): void ->\n    if this._doneDeferred:\n      if this._error:\n        this._doneDeferred.reject(this._error)\n      elif this._end and this._finish:\n        this._doneDeferred.resolve(this)\n\n\nexport handleStream(stream, handler: StreamHandler): void ->\n  handler.stream = stream\n\n  stream.on('error', (err): void ->\n    handler._error = err\n\n    // XXX: Google's grpc.js doesn't do any client-side error handling.\n    // The only way to indicate an uncaught client side error is to\n    // cancel the gRPC call.\n    if handler._isClient:\n      // console.log(\"cancelling call due to error\")\n      stream.cancel()\n\n    if not handler._iFailed:\n      handler.error(err, false)\n    else:\n      handler.error(err, true)\n    handler._internal()\n  )\n\n  handler.start(stream)\n\n  stream.on('data', (packet): void ->\n    let hres\n    try:\n      now hres = handler.data(packet, stream)\n    catch err:\n      handler.end(err)\n      return\n\n    // Handler may be sync or async. If it's a promise, handle it\n    if isThenable(hres):\n      hres\n        .then! (val): void ->\n          if val and typeof(val) == \"object\":\n            stream.write(val)\n        .catch! (err): void ->\n          handler.end(err)\n  )\n\n  stream.on('end', ->\n    handler._end = true\n    // Remote hangup\n    handler.hangup()\n    handler._internal()\n  )\n\n  stream.on('finish', ->\n    handler._finish = true\n    handler._internal()\n  )\n","import { classifyMethod } from './util'\nimport { handleStream, StreamHandler } from './StreamHandler'\n\n// Based on grpc-mod\nwrapUnaryMethod(method, context) ->\n  grpcUnary(request, metadata) ->\n    if metadata:\n      new Promise! (resolve, reject) ->\n        method.call(context, request, metadata, (err, response) -> if err: reject(err) else: resolve(response))\n    else:\n      new Promise! (resolve, reject) ->\n        method.call(context, request, (err, response) -> if err: reject(err) else: resolve(response))\n\n// Streams are already async iterable.\nwrapResponseStreamMethod(method, context) -> method.bind(context)\n\n// When calling a method with a request stream, the user provides an async\n// generator that produces the stream of values.\nwrapRequestStreamMethod(method, context) ->\n  grpcRequestStream(asyncGenerator, metadata) ->\n    // Promisify the grpc callback\n    new Promise! (resolve, reject): void => {\n      let stream = null\n\n      // Dump from the async generator to the stream\n      writer = (): void -/>\n        try:\n          for await (packet of asyncGenerator(stream)): stream.write(packet)\n        catch err:\n          // If the async generator errors, cancel the call to the\n          // server.\n          stream.cancel()\n          // XXX: custom error type, \"ClientError\"?\n          reject(err)\n        finally:\n          stream.end()\n\n      now stream = if metadata:\n        method.call(context, metadata, (err, response) -> if err: reject(err) else: resolve(response))\n      else:\n        method.call(context, (err, response) -> if err: reject(err) else: resolve(response))\n\n      writer()\n    } // new Promise!\n\n// For the time being, just use the streaming API.\n// There is probably some solution involving async generators but in this case\n// it is going to require a bunch of combinators and be really slow.\nwrapBidiStreamMethod(method, context) ->\n  grpcBidiStream(handler): StreamHandler ->\n    stream = method.call(context)\n    handler.stream = stream\n    // XXX: client-side handlers need different error handling\n    handler._isClient = true\n    handleStream(stream, handler)\n    handler\n\nwrapMethod(methodName, method, context) ->\n  classification = classifyMethod(method)\n\n  match classification:\n    | 'unary':\n      wrapUnaryMethod(method, context)\n    | 'requestStream':\n      wrapRequestStreamMethod(method, context)\n    | 'responseStream':\n      wrapResponseStreamMethod(method, context)\n    | 'bidirectionalStream':\n      wrapBidiStreamMethod(method, context)\n    | else:\n      // XXX: throw?\n      console.log(`Couldn't wrap method ${methodName}`)\n      method\n\n// Allow clients to be enhanced\nexport class ClientEnhancer:\n  constructor(grpcClient) ->\n    this.grpcClient = grpcClient\n    this._wrapMethods()\n\n  _wrapMethods(): void ->\n    { grpcClient } = this\n\n    for key k, val method in Object.getPrototypeOf(grpcClient):\n      if typeof(method) == 'function':\n        this[k] = wrapMethod(k, method, grpcClient)\n","import { classifyMethod } from './util'\nimport { handleStream } from './StreamHandler'\n\nclass UnaryResponse {}\n\nmarshalUnary(promisedUnary, callback, marshalErrorContext) ->\n  promisedUnary\n    .then! (result) ->\n      if typeof(result) != 'object':\n        throw new Error(\"invalid response\")\n      elif result instanceof UnaryResponse:\n        callback(null, result.value, result.trailer, result.flags)\n      else:\n        callback(null, result)\n    .catch! (err) ->\n      callback(marshalErrorContext.marshalError(err))\n\n// Marshal a stream of response objects produced by an async generator function.\nmarshalStream(asyncGenerator, stream, marshalErrorContext, arg1, arg2) -/>\n  try:\n    asyncGeneratorInstance = asyncGenerator(arg1, arg2)\n    for await (packet of asyncGeneratorInstance): stream.write(packet)\n    stream.end()\n  catch err:\n    // gRPC automatically destroys the stream on error event.\n    stream.emit('error', marshalErrorContext.marshalError(err))\n\n// XXX: metadata api\nexport class ServerEnhancer:\n  constructor(grpcServer) ->\n    this.grpcServer = grpcServer\n\n  // Promisified bindAsync\n  bind(port, credentials): Promise<bool> ->\n    server = this.grpcServer\n    new Promise! (resolve, reject) ->\n      server.bindAsync(port, credentials, (err) ->\n        if err:\n          reject(err)\n        else:\n          resolve(true)\n      )\n\n  start() ->\n    this.grpcServer.start()\n\n  // Promisified tryShutdown\n  shutdown(): Promise<bool> ->\n    server = this.grpcServer\n    new Promise! (resolve, reject) ->\n      server.tryShutdown! (err) -> if err: reject(err) else: resolve(true)\n\n  // Override in a subclass to control how JS errors are marshalled into\n  // gRPC errors and returned to the client.\n  marshalError(err) -> err\n\n  _wrapUnary(asyncHandler) ->\n    unaryAsyncHandler(call, callback): void =>\n      marshalUnary(asyncHandler(call.request, call), callback, this)\n\n  _wrapRequestStream(asyncHandler) ->\n    requestStreamAsyncHandler(stream, callback): void =>\n      // In Node 10, stream is an async iterable which is how request streams\n      // should be processed.\n      marshalUnary(asyncHandler(stream), callback, this)\n\n  _wrapResponseStream(asyncGenerator) ->\n    responseStreamAsyncHandler(stream): void =>\n      marshalStream(asyncGenerator, stream, this, stream.request, stream)\n\n  _wrapBidiStream(handlerClass) ->\n    marshalContext = this\n    bidiStreamAsyncHandler(stream): void ->\n      handler = new handlerClass(stream, marshalContext)\n      handler.marshalError = (err) -> marshalContext.marshalError(err)\n      handleStream(stream, handler)\n\n  addService(serviceDef, bindings): void ->\n    // Transform bindings\n    nextBindings = {...for key name, val handler in bindings:\n      // Get protobuf method definition\n      methodDef = serviceDef[name]\n      if not methodDef:\n        throw new Error(`ServerEnhancer.addService: service has no method named ${name}`)\n\n      // Wrap async handlers\n      {[name]: match classifyMethod(methodDef):\n        | 'unary': this._wrapUnary(handler)\n        | 'requestStream': this._wrapRequestStream(handler)\n        | 'responseStream': this._wrapResponseStream(handler)\n        | 'bidirectionalStream': this._wrapBidiStream(handler)\n        | else: throw new Error(\"invalid method definition \" + name)\n      }\n    }\n    this.grpcServer.addService(serviceDef, nextBindings)\n"],"names":["fs","require","path","Protobuf","descriptor","camelCase","descriptorOptions","longs","String","enums","bytes","defaults","oneofs","json","joinName","baseName","name","isHandledReflectionObject","obj","Service","Type","Enum","isNamespaceBase","Namespace","Root","getAllHandledReflectionObjects","parentName","objName","nested","undefined","Object","keys","map","reduce","accumulator","currentValue","concat","createDeserializer","cls","options","deserialize","argBuf","toObject","decode","createSerializer","serialize","arg","message","fromObject","encode","finish","createMethodDefinition","method","serviceName","requestType","resolvedRequestType","responseType","resolvedResponseType","requestStream","responseStream","requestSerialize","requestDeserialize","responseSerialize","responseDeserialize","originalName","createMessageDefinition","createServiceDefinition","service","def","_i","_a","methodsArray","length","fileDescriptorCache","Map","getFileDescriptors","root","has","get","descriptorList","toDescriptor","file","bufferList","value","Buffer","from","FileDescriptorProto","set","messageDescriptor","format","type","$type","fileDescriptorProtos","createEnumDefinition","enumType","enumDescriptor","createDefinition","Error","createPackageDefinition","resolveAll","_b","addIncludePathResolver","includePaths","originalResolvePath","resolvePath","origin","target","isAbsolute","includePaths_1","directory","fullPath","join","accessSync","constants","R_OK","err","loadSync","filename","includeDirs","Array","isArray","loadedRoot","wellKnownProtos","sourceDir","dirname","resolve","wellKnownProtos_1","proto","descriptor_1","toJSON","common","google","grpc","at","ret","e","Protocols","_loaded","_root","_includeDirs","_files","_pkgs","loadOptions","keepCase","setProtoPath","addProtoPath","dir","push","client","protoName","port","credentials","opts","pth","split","typeName","lookupType","protoFile","fileName","existsSync","load","assign","pkgDef","loadPackageDefinition","deferred","classifyMethod","isThenable","thing","ty","then","StreamHandler","constructor","stream","with","callbacks","next","marshalError","end","_iFailed","emit","write","data","error","isInternal","start","hangup","packet","closedPromise","getError","Promise","reject","isClosed","_doneDeferred","promise","_error","_end","_finish","_internal","handleStream","handler","on","_isClient","cancel","hres","val","catch","wrapUnaryMethod","context","grpcUnary","request","metadata","call","response","wrapResponseStreamMethod","bind","wrapRequestStreamMethod","grpcRequestStream","asyncGenerator","writer","wrapBidiStreamMethod","grpcBidiStream","wrapMethod","methodName","classification","console","log","ClientEnhancer","grpcClient","_wrapMethods","getPrototypeOf","k","UnaryResponse","marshalUnary","promisedUnary","callback","marshalErrorContext","result","trailer","flags","marshalStream","arg1","arg2","asyncGeneratorInstance","ServerEnhancer","grpcServer","server","bindAsync","shutdown","tryShutdown","_wrapUnary","asyncHandler","unaryAsyncHandler","_wrapRequestStream","requestStreamAsyncHandler","_wrapResponseStream","responseStreamAsyncHandler","_wrapBidiStream","handlerClass","marshalContext","bidiStreamAsyncHandler","addService","serviceDef","bindings","nextBindings","methodDef"],"mappings":"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"}